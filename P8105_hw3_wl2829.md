P8105\_hw3\_wl2829
================
Wentong
10/15/2021

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──

    ## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
    ## ✓ tibble  3.1.4     ✓ dplyr   1.0.7
    ## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
    ## ✓ readr   2.0.1     ✓ forcats 0.5.1

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(dplyr)
library(stringr)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

``` r
library(p8105.datasets)
data("instacart")
```

``` r
instacart %>% 
  count(aisle_id) %>% 
  nrow()   ## The total number of aisles.
```

    ## [1] 134

``` r
instacart %>% 
  distinct() %>% 
  count(aisle, name = "aisle_n") %>% 
  mutate(aisle_n = as.numeric(aisle_n)) %>% 
  arrange(desc(aisle_n)) %>%
  filter(aisle_n == max(aisle_n))
```

    ## # A tibble: 1 × 2
    ##   aisle            aisle_n
    ##   <chr>              <dbl>
    ## 1 fresh vegetables  150609

``` r
## "Fresh vegetables" has the most items. The number of orders is 150609.
```

``` r
plot_df = 
  instacart %>% 
  distinct() %>% 
  count(aisle, name = "aisle_n") %>% 
  mutate(aisle_n = as.numeric(aisle_n)) %>% 
  filter(aisle_n >= 10000) %>% 
  arrange(desc(aisle_n)) %>% 
  mutate(
    aisle = factor(aisle),
    aisle = forcats::fct_reorder(aisle, sort(aisle_n))) %>% 
  ggplot(aes(x = aisle, y = aisle_n)) +
  geom_point() + 
  coord_flip() +
  labs(
    title = "Number of items more than 10000",
    x = "number of itmes",
    y = "name of items",
    caption = "Data from instacart; number of items."
  )
```

``` r
Bi_df = 
  instacart %>% 
  filter(aisle == "baking ingredients") %>%   ## select the specific aisle
  count(product_name, name = "product_n") %>% ## count the number of each product
  arrange(desc(product_n)) %>% 
  head(3) %>% ## order the number and pick the three most popular items
  mutate(aisles_name = "baking ingredients") %>% 
  select(aisles_name, product_name, product_n) ## rearrange the table

dfc_df = 
  instacart %>% 
  filter(aisle == "dog food care") %>% 
  count(product_name, name = "product_n") %>% 
  arrange(desc(product_n)) %>% 
  head(3) %>% 
  mutate(aisles_name = "dog food care") %>% 
  select(aisles_name, product_name, product_n)

pvf_df = 
  instacart %>% 
  filter(aisle == "packaged vegetables fruits") %>% 
  count(product_name, name = "product_n") %>% 
  arrange(desc(product_n)) %>% 
  head(3) %>% 
  mutate(aisles_name = "packaged vegetables fruits") %>% 
  select(aisles_name, product_name, product_n)

three_aisles_df = 
  rbind(Bi_df, dfc_df, pvf_df)
```

Make a table showing the mean hour of the day at which Pink Lady Apples
and Coffee Ice Cream are ordered on each day of the week; format this
table for human readers (i.e. produce a 2 x 7 table).

``` r
mean_hour_df = 
  instacart %>% 
  filter(product_name %in% c("Coffee Ice Cream", "Pink Lady Apples")) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(
    mean_hour = mean(order_hour_of_day)
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) %>% 
  rename("Sun" = "0","Mon" = "1", "Tue" = "2", "Wed" = "3", "Thu" = "4", "Fri" = "5", "Sat" = "6")
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the `.groups` argument.

## Problem 2

``` r
library(p8105.datasets)
```

``` r
BRFSS_df = 
  brfss_smart2010 %>% 
  ## need change the variables' name
  janitor::clean_names() %>% 
  rename(state = locationabbr, specific_location = locationdesc) %>% 
  filter(topic == "Overall Health") %>% 
  filter(response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% 
  mutate(response = factor(response), 
         response = forcats::fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent")))
```

``` r
BRFSS_df %>% 
  filter(year == 2002) %>% 
  select(state, specific_location) %>% 
  distinct() %>% 
  count(state, name = "ob_n") %>% 
  filter(ob_n >= 7)
```

    ## # A tibble: 6 × 2
    ##   state  ob_n
    ##   <chr> <int>
    ## 1 CT        7
    ## 2 FL        7
    ## 3 MA        8
    ## 4 NC        7
    ## 5 NJ        8
    ## 6 PA       10

``` r
BRFSS_df %>% 
  filter(year == 2010) %>% 
  select(state, specific_location) %>% 
  distinct() %>% 
  count(state, name = "ob_n") %>% 
  filter(ob_n >= 7)
```

    ## # A tibble: 14 × 2
    ##    state  ob_n
    ##    <chr> <int>
    ##  1 CA       12
    ##  2 CO        7
    ##  3 FL       41
    ##  4 MA        9
    ##  5 MD       12
    ##  6 NC       12
    ##  7 NE       10
    ##  8 NJ       19
    ##  9 NY        9
    ## 10 OH        8
    ## 11 PA        7
    ## 12 SC        7
    ## 13 TX       16
    ## 14 WA       10

``` r
BRFSS_df %>% 
  filter(response == "Excellent") %>% 
  group_by(year, state) %>% 
  mutate(
    mean_value = mean(data_value, na.rm = TRUE)
  ) %>% 
  select(year, state, mean_value) %>% 
  distinct() %>% 
  ggplot(aes(x = year, y = mean_value)) +
  geom_line(aes(group = state, color = state))
```

<img src="P8105_hw3_wl2829_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" />

``` r
two_panel_plot = 
  BRFSS_df %>% 
  filter(year %in% c(2006, 2010)) %>% 
  filter(state == "NY") %>% 
  ggplot(aes(x = specific_location, y = data_value)) +
  geom_point() +
  coord_flip() +
  facet_grid(. ~ year)
```

## Problem 3

``` r
acce_df = 
  read_csv("./data/accel_data.csv") %>% 
  pivot_longer(
    activity.1:activity.1440,
    names_to = "number of activity",
    values_to = "activity"  
  ) %>% 
  janitor::clean_names() %>% 
  mutate_at("number_of_activity", str_replace, "activity.", "")
```

    ## Rows: 35 Columns: 1443

    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr    (1): day
    ## dbl (1442): week, day_id, activity.1, activity.2, activity.3, activity.4, ac...

    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
